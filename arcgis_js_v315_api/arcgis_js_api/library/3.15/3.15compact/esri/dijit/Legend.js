// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt for details.
//>>built
require({cache:{"dijit/a11y":function(){define("dojo/_base/array dojo/dom dojo/dom-attr dojo/dom-style dojo/_base/lang dojo/sniff ./main".split(" "),function(h,m,l,c,k,e,g){var a={_isElementShown:function(a){var g=c.get(a);return"hidden"!=g.visibility&&"collapsed"!=g.visibility&&"none"!=g.display&&"hidden"!=l.get(a,"type")},hasDefaultTabStop:function(a){switch(a.nodeName.toLowerCase()){case "a":return l.has(a,"href");case "area":case "button":case "input":case "object":case "select":case "textarea":return!0;
case "iframe":var g;try{var c=a.contentDocument;if("designMode"in c&&"on"==c.designMode)return!0;g=c.body}catch(e){try{g=a.contentWindow.document.body}catch(k){return!1}}return g&&("true"==g.contentEditable||g.firstChild&&"true"==g.firstChild.contentEditable);default:return"true"==a.contentEditable}},effectiveTabIndex:function(b){return l.get(b,"disabled")?void 0:l.has(b,"tabIndex")?+l.get(b,"tabIndex"):a.hasDefaultTabStop(b)?0:void 0},isTabNavigable:function(b){return 0<=a.effectiveTabIndex(b)},
isFocusable:function(b){return-1<=a.effectiveTabIndex(b)},_getTabNavigable:function(b){function g(a){return a&&"input"==a.tagName.toLowerCase()&&a.type&&"radio"==a.type.toLowerCase()&&a.name&&a.name.toLowerCase()}var c,k,h,d,p,m,x={},z=a._isElementShown,v=a.effectiveTabIndex,s=function(a){for(a=a.firstChild;a;a=a.nextSibling)if(!(1!=a.nodeType||9>=e("ie")&&"HTML"!==a.scopeName||!z(a))){var b=v(a);if(0<=b){if(0==b)c||(c=a),k=a;else if(0<b){if(!h||b<d)d=b,h=a;if(!p||b>=m)m=b,p=a}b=g(a);l.get(a,"checked")&&
b&&(x[b]=a)}"SELECT"!=a.nodeName.toUpperCase()&&s(a)}};z(b)&&s(b);return{first:x[g(c)]||c,last:x[g(k)]||k,lowest:x[g(h)]||h,highest:x[g(p)]||p}},getFirstInTabbingOrder:function(b,g){var c=a._getTabNavigable(m.byId(b,g));return c.lowest?c.lowest:c.first},getLastInTabbingOrder:function(b,g){var c=a._getTabNavigable(m.byId(b,g));return c.last?c.last:c.highest}};k.mixin(g,a);return a})},"dijit/a11yclick":function(){define(["dojo/keys","dojo/mouse","dojo/on","dojo/touch"],function(h,m,l,c){function k(a){if((a.keyCode===
h.ENTER||a.keyCode===h.SPACE)&&!/input|button|textarea/i.test(a.target.nodeName))for(a=a.target;a;a=a.parentNode)if(a.dojoClick)return!0}var e;l(document,"keydown",function(a){k(a)?(e=a.target,a.preventDefault()):e=null});l(document,"keyup",function(a){k(a)&&a.target==e&&(e=null,l.emit(a.target,"click",{cancelable:!0,bubbles:!0,ctrlKey:a.ctrlKey,shiftKey:a.shiftKey,metaKey:a.metaKey,altKey:a.altKey,_origType:a.type}))});var g=function(a,b){a.dojoClick=!0;return l(a,"click",b)};g.click=g;g.press=function(a,
b){var g=l(a,c.press,function(a){("mousedown"!=a.type||m.isLeft(a))&&b(a)}),e=l(a,"keydown",function(a){(a.keyCode===h.ENTER||a.keyCode===h.SPACE)&&b(a)});return{remove:function(){g.remove();e.remove()}}};g.release=function(a,b){var g=l(a,c.release,function(a){("mouseup"!=a.type||m.isLeft(a))&&b(a)}),e=l(a,"keyup",function(a){(a.keyCode===h.ENTER||a.keyCode===h.SPACE)&&b(a)});return{remove:function(){g.remove();e.remove()}}};g.move=c.move;return g})},"dijit/hccss":function(){define(["dojo/dom-class",
"dojo/hccss","dojo/domReady","dojo/_base/window"],function(h,m,l,c){l(function(){m("highcontrast")&&h.add(c.body(),"dijit_a11y")});return m})},"dijit/Destroyable":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(h,m,l){return l("dijit.Destroyable",null,{destroy:function(c){this._destroyed=!0},own:function(){var c=["destroyRecursive","destroy","remove"];h.forEach(arguments,function(k){function e(){a.remove();h.forEach(b,function(a){a.remove()})}var g,a=m.before(this,
"destroy",function(a){k[g](a)}),b=[];k.then?(g="cancel",k.then(e,e)):h.forEach(c,function(a){"function"===typeof k[a]&&(g||(g=a),b.push(m.after(k,a,e,!0)))})},this);return arguments}})})},"esri/dijit/_EventedWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/on ../Evented dijit/_WidgetBase".split(" "),function(h,m,l,c,k,e){return h([e,k],{_onMap:function(g){var a=this.constructor._onMap,b;if(!a||!a.FINAL)delete this.constructor._onMap,a=this.registerConnectEvents(),a.FINAL=
!0;g=g.toLowerCase();a[g]?b=this[a[g].method]:(g=this._onCamelCase(g),this[g]&&(b=g));return b},on:function(g,a){var b=this._onMap(g),e=g.replace(/\-/g,""),k="on"+e in this.domNode;return b||!k?this.inherited(arguments):this.own(c(this.domNode,e,a))[0]},emit:function(g,a,b){var c,e,k,l=g.toLowerCase(),d=this.constructor._onMap||this.registerConnectEvents();e=this[this._onMap(l)];a=a||{};a.target||(a.target=this);e&&(d&&d[l])&&(this._onObj2Arr(function(){c=Array.prototype.slice.call(arguments)},d[l].argKeys)(a),
k=m.mixin({},arguments),k[2]=c,k[0]=d[l].name.replace(/^on/,""));return this.inherited(k||arguments)}})})},"dojox/html/entities":function(){define(["dojo/_base/lang"],function(h){var m=h.getObject("dojox.html.entities",!0),l=function(c,e){var g,a;if(e._encCache&&e._encCache.regexp&&e._encCache.mapper&&e.length==e._encCache.length)g=e._encCache.mapper,a=e._encCache.regexp;else{g={};a=["["];var b;for(b=0;b<e.length;b++)g[e[b][0]]="\x26"+e[b][1]+";",a.push(e[b][0]);a.push("]");a=RegExp(a.join(""),"g");
e._encCache={mapper:g,regexp:a,length:e.length}}return c=c.replace(a,function(a){return g[a]})},c=function(c,e){var g,a;if(e._decCache&&e._decCache.regexp&&e._decCache.mapper&&e.length==e._decCache.length)g=e._decCache.mapper,a=e._decCache.regexp;else{g={};a=["("];var b;for(b=0;b<e.length;b++){var l="\x26"+e[b][1]+";";b&&a.push("|");g[l]=e[b][0];a.push(l)}a.push(")");a=RegExp(a.join(""),"g");e._decCache={mapper:g,regexp:a,length:e.length}}return c=c.replace(a,function(a){return g[a]})};m.html=[["\x26",
"amp"],['"',"quot"],["\x3c","lt"],["\x3e","gt"],["\u00a0","nbsp"]];m.latin=[["\u00a1","iexcl"],["\u00a2","cent"],["\u00a3","pound"],["\u20ac","euro"],["\u00a4","curren"],["\u00a5","yen"],["\u00a6","brvbar"],["\u00a7","sect"],["\u00a8","uml"],["\u00a9","copy"],["\u00aa","ordf"],["\u00ab","laquo"],["\u00ac","not"],["\u00ad","shy"],["\u00ae","reg"],["\u00af","macr"],["\u00b0","deg"],["\u00b1","plusmn"],["\u00b2","sup2"],["\u00b3","sup3"],["\u00b4","acute"],["\u00b5","micro"],["\u00b6","para"],["\u00b7",
"middot"],["\u00b8","cedil"],["\u00b9","sup1"],["\u00ba","ordm"],["\u00bb","raquo"],["\u00bc","frac14"],["\u00bd","frac12"],["\u00be","frac34"],["\u00bf","iquest"],["\u00c0","Agrave"],["\u00c1","Aacute"],["\u00c2","Acirc"],["\u00c3","Atilde"],["\u00c4","Auml"],["\u00c5","Aring"],["\u00c6","AElig"],["\u00c7","Ccedil"],["\u00c8","Egrave"],["\u00c9","Eacute"],["\u00ca","Ecirc"],["\u00cb","Euml"],["\u00cc","Igrave"],["\u00cd","Iacute"],["\u00ce","Icirc"],["\u00cf","Iuml"],["\u00d0","ETH"],["\u00d1","Ntilde"],
["\u00d2","Ograve"],["\u00d3","Oacute"],["\u00d4","Ocirc"],["\u00d5","Otilde"],["\u00d6","Ouml"],["\u00d7","times"],["\u00d8","Oslash"],["\u00d9","Ugrave"],["\u00da","Uacute"],["\u00db","Ucirc"],["\u00dc","Uuml"],["\u00dd","Yacute"],["\u00de","THORN"],["\u00df","szlig"],["\u00e0","agrave"],["\u00e1","aacute"],["\u00e2","acirc"],["\u00e3","atilde"],["\u00e4","auml"],["\u00e5","aring"],["\u00e6","aelig"],["\u00e7","ccedil"],["\u00e8","egrave"],["\u00e9","eacute"],["\u00ea","ecirc"],["\u00eb","euml"],
["\u00ec","igrave"],["\u00ed","iacute"],["\u00ee","icirc"],["\u00ef","iuml"],["\u00f0","eth"],["\u00f1","ntilde"],["\u00f2","ograve"],["\u00f3","oacute"],["\u00f4","ocirc"],["\u00f5","otilde"],["\u00f6","ouml"],["\u00f7","divide"],["\u00f8","oslash"],["\u00f9","ugrave"],["\u00fa","uacute"],["\u00fb","ucirc"],["\u00fc","uuml"],["\u00fd","yacute"],["\u00fe","thorn"],["\u00ff","yuml"],["\u0192","fnof"],["\u0391","Alpha"],["\u0392","Beta"],["\u0393","Gamma"],["\u0394","Delta"],["\u0395","Epsilon"],["\u0396",
"Zeta"],["\u0397","Eta"],["\u0398","Theta"],["\u0399","Iota"],["\u039a","Kappa"],["\u039b","Lambda"],["\u039c","Mu"],["\u039d","Nu"],["\u039e","Xi"],["\u039f","Omicron"],["\u03a0","Pi"],["\u03a1","Rho"],["\u03a3","Sigma"],["\u03a4","Tau"],["\u03a5","Upsilon"],["\u03a6","Phi"],["\u03a7","Chi"],["\u03a8","Psi"],["\u03a9","Omega"],["\u03b1","alpha"],["\u03b2","beta"],["\u03b3","gamma"],["\u03b4","delta"],["\u03b5","epsilon"],["\u03b6","zeta"],["\u03b7","eta"],["\u03b8","theta"],["\u03b9","iota"],["\u03ba",
"kappa"],["\u03bb","lambda"],["\u03bc","mu"],["\u03bd","nu"],["\u03be","xi"],["\u03bf","omicron"],["\u03c0","pi"],["\u03c1","rho"],["\u03c2","sigmaf"],["\u03c3","sigma"],["\u03c4","tau"],["\u03c5","upsilon"],["\u03c6","phi"],["\u03c7","chi"],["\u03c8","psi"],["\u03c9","omega"],["\u03d1","thetasym"],["\u03d2","upsih"],["\u03d6","piv"],["\u2022","bull"],["\u2026","hellip"],["\u2032","prime"],["\u2033","Prime"],["\u203e","oline"],["\u2044","frasl"],["\u2118","weierp"],["\u2111","image"],["\u211c","real"],
["\u2122","trade"],["\u2135","alefsym"],["\u2190","larr"],["\u2191","uarr"],["\u2192","rarr"],["\u2193","darr"],["\u2194","harr"],["\u21b5","crarr"],["\u21d0","lArr"],["\u21d1","uArr"],["\u21d2","rArr"],["\u21d3","dArr"],["\u21d4","hArr"],["\u2200","forall"],["\u2202","part"],["\u2203","exist"],["\u2205","empty"],["\u2207","nabla"],["\u2208","isin"],["\u2209","notin"],["\u220b","ni"],["\u220f","prod"],["\u2211","sum"],["\u2212","minus"],["\u2217","lowast"],["\u221a","radic"],["\u221d","prop"],["\u221e",
"infin"],["\u2220","ang"],["\u2227","and"],["\u2228","or"],["\u2229","cap"],["\u222a","cup"],["\u222b","int"],["\u2234","there4"],["\u223c","sim"],["\u2245","cong"],["\u2248","asymp"],["\u2260","ne"],["\u2261","equiv"],["\u2264","le"],["\u2265","ge"],["\u2282","sub"],["\u2283","sup"],["\u2284","nsub"],["\u2286","sube"],["\u2287","supe"],["\u2295","oplus"],["\u2297","otimes"],["\u22a5","perp"],["\u22c5","sdot"],["\u2308","lceil"],["\u2309","rceil"],["\u230a","lfloor"],["\u230b","rfloor"],["\u2329",
"lang"],["\u232a","rang"],["\u25ca","loz"],["\u2660","spades"],["\u2663","clubs"],["\u2665","hearts"],["\u2666","diams"],["\u0152","OElig"],["\u0153","oelig"],["\u0160","Scaron"],["\u0161","scaron"],["\u0178","Yuml"],["\u02c6","circ"],["\u02dc","tilde"],["\u2002","ensp"],["\u2003","emsp"],["\u2009","thinsp"],["\u200c","zwnj"],["\u200d","zwj"],["\u200e","lrm"],["\u200f","rlm"],["\u2013","ndash"],["\u2014","mdash"],["\u2018","lsquo"],["\u2019","rsquo"],["\u201a","sbquo"],["\u201c","ldquo"],["\u201d",
"rdquo"],["\u201e","bdquo"],["\u2020","dagger"],["\u2021","Dagger"],["\u2030","permil"],["\u2039","lsaquo"],["\u203a","rsaquo"]];m.encode=function(c,e){c&&(e?c=l(c,e):(c=l(c,m.html),c=l(c,m.latin)));return c};m.decode=function(l,e){l&&(e?l=c(l,e):(l=c(l,m.html),l=c(l,m.latin)));return l};return m})},"dijit/_Widget":function(){define("dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/has dojo/_base/kernel dojo/_base/lang dojo/query dojo/ready ./registry ./_WidgetBase ./_OnDijitClickMixin ./_FocusMixin dojo/uacss ./hccss".split(" "),
function(h,m,l,c,k,e,g,a,b,r,y,I,t){function d(){}function p(a){return function(b,c,e,k){return b&&"string"==typeof c&&b[c]==d?b.on(c.substring(2).toLowerCase(),g.hitch(e,k)):a.apply(l,arguments)}}h.around(l,"connect",p);e.connect&&h.around(e,"connect",p);h=c("dijit._Widget",[y,I,t],{onClick:d,onDblClick:d,onKeyDown:d,onKeyPress:d,onKeyUp:d,onMouseDown:d,onMouseMove:d,onMouseOut:d,onMouseOver:d,onMouseLeave:d,onMouseEnter:d,onMouseUp:d,constructor:function(a){this._toConnect={};for(var b in a)this[b]===
d&&(this._toConnect[b.replace(/^on/,"").toLowerCase()]=a[b],delete a[b])},postCreate:function(){this.inherited(arguments);for(var a in this._toConnect)this.on(a,this._toConnect[a]);delete this._toConnect},on:function(a,b){return this[this._onMap(a)]===d?l.connect(this.domNode,a.toLowerCase(),this,b):this.inherited(arguments)},_setFocusedAttr:function(a){this._focused=a;this._set("focused",a)},setAttribute:function(a,b){e.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.",
"","2.0");this.set(a,b)},attr:function(a,b){return 2<=arguments.length||"object"===typeof a?this.set.apply(this,arguments):this.get(a)},getDescendants:function(){e.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0");return this.containerNode?a("[widgetId]",this.containerNode).map(r.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}});k("dijit-legacy-requires")&&b(0,function(){require(["dijit/_base"])});
return h})},"dijit/_WidgetBase":function(){define("require dojo/_base/array dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/_base/kernel dojo/_base/lang dojo/on dojo/ready dojo/Stateful dojo/topic dojo/_base/window ./Destroyable dojo/has!dojo-bidi?./_BidiMixin ./registry".split(" "),function(h,m,l,c,k,e,g,a,b,r,y,I,t,d,p,w,x,z,v,s,B,G,D){function E(b){return function(c){a[c?
"set":"remove"](this.domNode,b,c);this._set(b,c)}}t.add("dijit-legacy-requires",!d.isAsync);t.add("dojo-bidi",!1);t("dijit-legacy-requires")&&x(0,function(){h(["dijit/_base/manager"])});var J={};c=e("dijit._WidgetBase",[z,B],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:E("lang"),dir:"",_setDirAttr:E("dir"),"class":"",_setClassAttr:{node:"domNode",type:"class"},_setTypeAttr:null,style:"",title:"",tooltip:"",baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(a){this._set("ownerDocument",
a)},attributeMap:{},_blankGif:c.blankGif||h.toUrl("dojo/resources/blank.gif"),_introspect:function(){var a=this.constructor;if(!a._setterAttrs){var b=a.prototype,c=a._setterAttrs=[],a=a._onMap={},d;for(d in b.attributeMap)c.push(d);for(d in b)/^on/.test(d)&&(a[d.substring(2).toLowerCase()]=d),/^_set[A-Z](.*)Attr$/.test(d)&&(d=d.charAt(4).toLowerCase()+d.substr(5,d.length-9),(!b.attributeMap||!(d in b.attributeMap))&&c.push(d))}},postscript:function(a,b){this.create(a,b)},create:function(a,b){this._introspect();
this.srcNodeRef=g.byId(b);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&"string"==typeof this.srcNodeRef.id&&(this.id=this.srcNodeRef.id);a&&(this.params=a,p.mixin(this,a));this.postMixInProperties();this.id||(this.id=D.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.params&&delete this.params.id);this.ownerDocument=this.ownerDocument||(this.srcNodeRef?this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=s.body(this.ownerDocument);D.add(this);this.buildRendering();
var d;if(this.domNode){this._applyAttributes();var c=this.srcNodeRef;c&&(c.parentNode&&this.domNode!==c)&&(c.parentNode.replaceChild(this.domNode,c),d=!0);this.domNode.setAttribute("widgetId",this.id)}this.postCreate();d&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var a={},b;for(b in this.params||{})a[b]=this._get(b);m.forEach(this.constructor._setterAttrs,function(b){if(!(b in a)){var c=this._get(b);c&&this.set(b,c)}},this);for(b in a)this.set(b,a[b])},postMixInProperties:function(){},
buildRendering:function(){this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div"));if(this.baseClass){var a=this.baseClass.split(" ");this.isLeftToRight()||(a=a.concat(m.map(a,function(a){return a+"Rtl"})));b.add(this.domNode,a)}},postCreate:function(){},startup:function(){this._started||(this._started=!0,m.forEach(this.getChildren(),function(a){!a._started&&(!a._destroyed&&p.isFunction(a.startup))&&(a.startup(),a._started=!0)}))},destroyRecursive:function(a){this._beingDestroyed=
!0;this.destroyDescendants(a);this.destroy(a)},destroy:function(a){function b(c){c.destroyRecursive?c.destroyRecursive(a):c.destroy&&c.destroy(a)}this._beingDestroyed=!0;this.uninitialize();m.forEach(this._connects,p.hitch(this,"disconnect"));m.forEach(this._supportingWidgets,b);this.domNode&&m.forEach(D.findWidgets(this.domNode,this.containerNode),b);this.destroyRendering(a);D.remove(this.id);this._destroyed=!0},destroyRendering:function(b){this.bgIframe&&(this.bgIframe.destroy(b),delete this.bgIframe);
this.domNode&&(b?a.remove(this.domNode,"widgetId"):r.destroy(this.domNode),delete this.domNode);this.srcNodeRef&&(b||r.destroy(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(a){m.forEach(this.getChildren(),function(b){b.destroyRecursive&&b.destroyRecursive(a)})},uninitialize:function(){return!1},_setStyleAttr:function(a){var b=this.domNode;p.isObject(a)?I.set(b,a):b.style.cssText=b.style.cssText?b.style.cssText+("; "+a):a;this._set("style",a)},_attrToDom:function(c,d,g){g=3<=
arguments.length?g:this.attributeMap[c];m.forEach(p.isArray(g)?g:[g],function(g){var e=this[g.node||g||"domNode"];switch(g.type||"attribute"){case "attribute":p.isFunction(d)&&(d=p.hitch(this,d));g=g.attribute?g.attribute:/^on[A-Z][a-zA-Z]*$/.test(c)?c.toLowerCase():c;e.tagName?a.set(e,g,d):e.set(g,d);break;case "innerText":e.innerHTML="";e.appendChild(this.ownerDocument.createTextNode(d));break;case "innerHTML":e.innerHTML=d;break;case "class":b.replace(e,d,this[c])}},this)},get:function(a){var b=
this._getAttrNames(a);return this[b.g]?this[b.g]():this._get(a)},set:function(a,b){if("object"===typeof a){for(var c in a)this.set(c,a[c]);return this}c=this._getAttrNames(a);var d=this[c.s];if(p.isFunction(d))var g=d.apply(this,Array.prototype.slice.call(arguments,1));else{var d=this.focusNode&&!p.isFunction(this.focusNode)?"focusNode":"domNode",e=this[d]&&this[d].tagName,l;if(l=e)if(!(l=J[e])){l=this[d];var k={},G;for(G in l)k[G.toLowerCase()]=!0;l=J[e]=k}G=l;c=a in this.attributeMap?this.attributeMap[a]:
c.s in this?this[c.s]:G&&c.l in G&&"function"!=typeof b||/^aria-|^data-|^role$/.test(a)?d:null;null!=c&&this._attrToDom(a,b,c);this._set(a,b)}return g||this},_attrPairNames:{},_getAttrNames:function(a){var b=this._attrPairNames;if(b[a])return b[a];var c=a.replace(/^[a-z]|-[a-zA-Z]/g,function(a){return a.charAt(a.length-1).toUpperCase()});return b[a]={n:a+"Node",s:"_set"+c+"Attr",g:"_get"+c+"Attr",l:c.toLowerCase()}},_set:function(a,b){var c=this[a];this[a]=b;if(this._created&&!(c===b||c!==c&&b!==
b))this._watchCallbacks&&this._watchCallbacks(a,c,b),this.emit("attrmodified-"+a,{detail:{prevValue:c,newValue:b}})},_get:function(a){return this[a]},emit:function(a,b,c){b=b||{};void 0===b.bubbles&&(b.bubbles=!0);void 0===b.cancelable&&(b.cancelable=!0);b.detail||(b.detail={});b.detail.widget=this;var d,g=this["on"+a];g&&(d=g.apply(this,c?c:[b]));this._started&&!this._beingDestroyed&&w.emit(this.domNode,a.toLowerCase(),b);return d},on:function(a,b){var c=this._onMap(a);return c?l.after(this,c,b,
!0):this.own(w(this.domNode,a,b))[0]},_onMap:function(a){var b=this.constructor,c=b._onMap;if(!c){var c=b._onMap={},d;for(d in b.prototype)/^on/.test(d)&&(c[d.replace(/^on/,"").toLowerCase()]=d)}return c["string"==typeof a&&a.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},getChildren:function(){return this.containerNode?D.findWidgets(this.containerNode):[]},getParent:function(){return D.getEnclosingWidget(this.domNode.parentNode)},connect:function(a,
b,c){return this.own(k.connect(a,b,this,c))[0]},disconnect:function(a){a.remove()},subscribe:function(a,b){return this.own(v.subscribe(a,p.hitch(this,b)))[0]},unsubscribe:function(a){a.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir.toLowerCase():y.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&"none"!=I.get(this.domNode,"display")},placeAt:function(a,b){var c=!a.tagName&&D.byId(a);c&&c.addChild&&(!b||"number"===typeof b)?c.addChild(this,b):(c=c&&"domNode"in
c?c.containerNode&&!/after|before|replace/.test(b||"")?c.containerNode:c.domNode:g.byId(a,this.ownerDocument),r.place(this.domNode,c,b),!this._started&&(this.getParent()||{})._started&&this.startup());return this},defer:function(a,b){var c=setTimeout(p.hitch(this,function(){c&&(c=null,this._destroyed||p.hitch(this,a)())}),b||0);return{remove:function(){c&&(clearTimeout(c),c=null);return null}}}});t("dojo-bidi")&&c.extend(G);return c})},"esri/numberUtils":function(){define(["dojo/has","dojo/number",
"dojo/i18n!dojo/cldr/nls/number","./kernel"],function(h,m,l,c){var k=function(c,a){return c-a},e={_reNumber:/^-?(\d+)(\.(\d+))?$/i,getDigits:function(c){var a=String(c),b=a.match(e._reNumber);c={integer:0,fractional:0};b&&b[1]?(c.integer=b[1].split("").length,c.fractional=b[3]?b[3].split("").length:0):-1<a.toLowerCase().indexOf("e")&&(b=a.split("e"),a=b[0],b=b[1],a&&b&&(a=Number(a),b=Number(b),(c=0<b)||(b=Math.abs(b)),a=e.getDigits(a),c?(a.integer+=b,a.fractional=b>a.fractional?0:a.fractional-b):
(a.fractional+=b,a.integer=b>a.integer?1:a.integer-b),c=a));return c},getFixedNumbers:function(c,a){var b,e;b=Number(c.toFixed(a));b<c?e=b+1/Math.pow(10,a):(e=b,b-=1/Math.pow(10,a));b=Number(b.toFixed(a));e=Number(e.toFixed(a));return[b,e]},getPctChange:function(c,a,b,e){var l={prev:null,next:null},k;null!=b&&(k=c-b,b=a-b-k,l.prev=Math.floor(Math.abs(100*b/k)));null!=e&&(k=e-c,b=e-a-k,l.next=Math.floor(Math.abs(100*b/k)));return l},round:function(c,a){var b=c.slice(0),l,h,m,t,d,p,w,x,z,v=!a||null==
a.tolerance?2:a.tolerance,s=a&&a.indexes,B=!a||null==a.strictBounds?!1:a.strictBounds;if(s)s.sort(k);else{s=[];for(p=0;p<b.length;p++)s.push(p)}for(p=0;p<s.length;p++)if(z=s[p],l=b[z],h=0===z?null:b[z-1],m=z===b.length-1?null:b[z+1],t=e.getDigits(l),t=t.fractional){w=0;for(x=!1;w<=t&&!x;)d=e.getFixedNumbers(l,w),d=B&&0===p?d[1]:d[0],x=e.hasMinimalChange(l,d,h,m,v),w++;x&&(b[z]=d)}return b},hasMinimalChange:function(c,a,b,l,k){c=e.getPctChange(c,a,b,l);a=null==c.prev||c.prev<=k;b=null==c.next||c.next<=
k;return a&&b||c.prev+c.next<=2*k},_reAllZeros:RegExp("\\"+l.decimal+"0+$","g"),_reSomeZeros:RegExp("(\\d)0*$","g"),format:function(c,a){a=a||{places:20,round:-1};var b=m.format(c,a);b&&(b=b.replace(e._reSomeZeros,"$1").replace(e._reAllZeros,""));return b}};h("extend-esri")&&(c.numberUtils=e);return e})},"dojo/debounce":function(){define([],function(){return function(h,m){var l;return function(){l&&clearTimeout(l);var c=this,k=arguments;l=setTimeout(function(){h.apply(c,k)},m)}}})},"dijit/_FocusMixin":function(){define(["./focus",
"./_WidgetBase","dojo/_base/declare","dojo/_base/lang"],function(h,m,l,c){c.extend(m,{focused:!1,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}});return l("dijit._FocusMixin",null,{_focusManager:h})})},"dojo/DeferredList":function(){define(["./_base/kernel","./_base/Deferred","./_base/array"],function(h,m,l){h.DeferredList=function(c,k,e,g,a){var b=[];m.call(this);var h=this;0===c.length&&!k&&this.resolve([0,[]]);var y=0;l.forEach(c,
function(a,l){function d(a,d){b[l]=[a,d];y++;y===c.length&&h.resolve(b)}a.then(function(a){k?h.resolve([l,a]):d(!0,a)},function(a){e?h.reject(a):d(!1,a);if(g)return null;throw a;})})};h.DeferredList.prototype=new m;h.DeferredList.prototype.gatherResults=function(c){c=new h.DeferredList(c,!1,!0,!1);c.addCallback(function(c){var e=[];l.forEach(c,function(c){e.push(c[1])});return e});return c};return h.DeferredList})},"dijit/focus":function(){define("dojo/aspect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/Evented dojo/_base/lang dojo/on dojo/domReady dojo/sniff dojo/Stateful dojo/_base/window dojo/window ./a11y ./registry ./main".split(" "),
function(h,m,l,c,k,e,g,a,b,r,y,I,t,d,p,w,x){var z,v,s=new (m([I,g],{curNode:null,activeStack:[],constructor:function(){var b=a.hitch(this,function(a){l.isDescendant(this.curNode,a)&&this.set("curNode",null);l.isDescendant(this.prevNode,a)&&this.set("prevNode",null)});h.before(e,"empty",b);h.before(e,"destroy",b)},registerIframe:function(a){return this.registerWin(a.contentWindow,a)},registerWin:function(a,c){var d=this,e=a.document&&a.document.body;if(e){var l=y("pointer-events")?"pointerdown":y("MSPointer")?
"MSPointerDown":y("touch-events")?"mousedown, touchstart":"mousedown",g=b(a.document,l,function(a){if(!a||!(a.target&&null==a.target.parentNode))d._onTouchNode(c||a.target,"mouse")}),k=b(e,"focusin",function(a){if(a.target.tagName){var b=a.target.tagName.toLowerCase();"#document"==b||"body"==b||(p.isFocusable(a.target)?d._onFocusNode(c||a.target):d._onTouchNode(c||a.target))}}),h=b(e,"focusout",function(a){d._onBlurNode(c||a.target)});return{remove:function(){g.remove();k.remove();h.remove();e=g=
k=h=null}}}},_onBlurNode:function(b){b=(new Date).getTime();b<z+100||(this._clearFocusTimer&&clearTimeout(this._clearFocusTimer),this._clearFocusTimer=setTimeout(a.hitch(this,function(){this.set("prevNode",this.curNode);this.set("curNode",null)}),0),this._clearActiveWidgetsTimer&&clearTimeout(this._clearActiveWidgetsTimer),b<v+100||(this._clearActiveWidgetsTimer=setTimeout(a.hitch(this,function(){delete this._clearActiveWidgetsTimer;this._setStack([])}),0)))},_onTouchNode:function(a,b){v=(new Date).getTime();
this._clearActiveWidgetsTimer&&(clearTimeout(this._clearActiveWidgetsTimer),delete this._clearActiveWidgetsTimer);k.contains(a,"dijitPopup")&&(a=a.firstChild);var e=[];try{for(;a;){var l=c.get(a,"dijitPopupParent");if(l)a=w.byId(l).domNode;else if(a.tagName&&"body"==a.tagName.toLowerCase()){if(a===t.body())break;a=d.get(a.ownerDocument).frameElement}else{var g=a.getAttribute&&a.getAttribute("widgetId"),h=g&&w.byId(g);h&&!("mouse"==b&&h.get("disabled"))&&e.unshift(g);a=a.parentNode}}}catch(p){}this._setStack(e,
b)},_onFocusNode:function(a){a&&9!=a.nodeType&&(z=(new Date).getTime(),this._clearFocusTimer&&(clearTimeout(this._clearFocusTimer),delete this._clearFocusTimer),this._onTouchNode(a),a!=this.curNode&&(this.set("prevNode",this.curNode),this.set("curNode",a)))},_setStack:function(a,b){var c=this.activeStack,d=c.length-1,e=a.length-1;if(a[e]!=c[d]){this.set("activeStack",a);var g;for(g=d;0<=g&&c[g]!=a[g];g--)if(d=w.byId(c[g]))d._hasBeenBlurred=!0,d.set("focused",!1),d._focusManager==this&&d._onBlur(b),
this.emit("widget-blur",d,b);for(g++;g<=e;g++)if(d=w.byId(a[g]))d.set("focused",!0),d._focusManager==this&&d._onFocus(b),this.emit("widget-focus",d,b)}},focus:function(a){if(a)try{a.focus()}catch(b){}}}));r(function(){var a=s.registerWin(d.get(document));y("ie")&&b(window,"unload",function(){a&&(a.remove(),a=null)})});x.focus=function(a){s.focus(a)};for(var B in s)/^_/.test(B)||(x.focus[B]="function"==typeof s[B]?a.hitch(s,B):s[B]);s.watch(function(a,b,c){x.focus[a]=c});return s})},"dojo/touch":function(){define("./_base/kernel ./aspect ./dom ./dom-class ./_base/lang ./on ./has ./mouse ./domReady ./_base/window".split(" "),
function(h,m,l,c,k,e,g,a,b,r){function y(a,b,c){return p&&c?function(a,b){return e(a,c,b)}:x?function(c,d){var g=e(c,b,function(a){d.call(this,a);H=(new Date).getTime()}),l=e(c,a,function(a){(!H||(new Date).getTime()>H+1E3)&&d.call(this,a)});return{remove:function(){g.remove();l.remove()}}}:function(b,c){return e(b,a,c)}}function I(a){do if(void 0!==a.dojoClick)return a;while(a=a.parentNode)}function t(a,b,d){var g=I(a.target);if(v=!a.target.disabled&&g&&g.dojoClick)if(B=(s="useTarget"==v)?g:a.target,
s&&a.preventDefault(),G=a.changedTouches?a.changedTouches[0].pageX-r.global.pageXOffset:a.clientX,D=a.changedTouches?a.changedTouches[0].pageY-r.global.pageYOffset:a.clientY,E=("object"==typeof v?v.x:"number"==typeof v?v:0)||4,J=("object"==typeof v?v.y:"number"==typeof v?v:0)||4,!z){z=!0;var k=function(a){v=s?l.isDescendant(r.doc.elementFromPoint(a.changedTouches?a.changedTouches[0].pageX-r.global.pageXOffset:a.clientX,a.changedTouches?a.changedTouches[0].pageY-r.global.pageYOffset:a.clientY),B):
v&&(a.changedTouches?a.changedTouches[0].target:a.target)==B&&Math.abs((a.changedTouches?a.changedTouches[0].pageX-r.global.pageXOffset:a.clientX)-G)<=E&&Math.abs((a.changedTouches?a.changedTouches[0].pageY-r.global.pageYOffset:a.clientY)-D)<=J};r.doc.addEventListener(b,function(a){k(a);s&&a.preventDefault()},!0);r.doc.addEventListener(d,function(a){k(a);if(v){N=(new Date).getTime();var b=s?B:a.target;"LABEL"===b.tagName&&(b=l.byId(b.getAttribute("for"))||b);var c=a.changedTouches?a.changedTouches[0]:
a,d=document.createEvent("MouseEvents");d._dojo_click=!0;d.initMouseEvent("click",!0,!0,a.view,a.detail,c.screenX,c.screenY,c.clientX,c.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,0,null);setTimeout(function(){e.emit(b,"click",d);N=(new Date).getTime()},0)}},!0);a=function(a){r.doc.addEventListener(a,function(b){!b._dojo_click&&((new Date).getTime()<=N+1E3&&!("INPUT"==b.target.tagName&&c.contains(b.target,"dijitOffScreen")))&&(b.stopPropagation(),b.stopImmediatePropagation&&b.stopImmediatePropagation(),
"click"==a&&(("INPUT"!=b.target.tagName||"radio"==b.target.type||"checkbox"==b.target.type)&&"TEXTAREA"!=b.target.tagName&&"AUDIO"!=b.target.tagName&&"VIDEO"!=b.target.tagName)&&b.preventDefault())},!0)};a("click");a("mousedown");a("mouseup")}}var d=5>g("ios"),p=g("pointer-events")||g("MSPointer"),w=function(){var a={},b;for(b in{down:1,move:1,up:1,cancel:1,over:1,out:1})a[b]=g("MSPointer")?"MSPointer"+b.charAt(0).toUpperCase()+b.slice(1):"pointer"+b;return a}(),x=g("touch-events"),z,v,s=!1,B,G,D,
E,J,N,H,K;p?b(function(){r.doc.addEventListener(w.down,function(a){t(a,w.move,w.up)},!0)}):x&&b(function(){function a(b){var c=k.delegate(b,{bubbles:!0});6<=g("ios")&&(c.touches=b.touches,c.altKey=b.altKey,c.changedTouches=b.changedTouches,c.ctrlKey=b.ctrlKey,c.metaKey=b.metaKey,c.shiftKey=b.shiftKey,c.targetTouches=b.targetTouches);return c}K=r.body();r.doc.addEventListener("touchstart",function(a){H=(new Date).getTime();var b=K;K=a.target;e.emit(b,"dojotouchout",{relatedTarget:K,bubbles:!0});e.emit(K,
"dojotouchover",{relatedTarget:b,bubbles:!0});t(a,"touchmove","touchend")},!0);e(r.doc,"touchmove",function(b){H=(new Date).getTime();var c=r.doc.elementFromPoint(b.pageX-(d?0:r.global.pageXOffset),b.pageY-(d?0:r.global.pageYOffset));c&&(K!==c&&(e.emit(K,"dojotouchout",{relatedTarget:c,bubbles:!0}),e.emit(c,"dojotouchover",{relatedTarget:K,bubbles:!0}),K=c),e.emit(c,"dojotouchmove",a(b))||b.preventDefault())});e(r.doc,"touchend",function(b){H=(new Date).getTime();var c=r.doc.elementFromPoint(b.pageX-
(d?0:r.global.pageXOffset),b.pageY-(d?0:r.global.pageYOffset))||r.body();e.emit(c,"dojotouchend",a(b))})});m={press:y("mousedown","touchstart",w.down),move:y("mousemove","dojotouchmove",w.move),release:y("mouseup","dojotouchend",w.up),cancel:y(a.leave,"touchcancel",p?w.cancel:null),over:y("mouseover","dojotouchover",w.over),out:y("mouseout","dojotouchout",w.out),enter:a._eventHandler(y("mouseover","dojotouchover",w.over)),leave:a._eventHandler(y("mouseout","dojotouchout",w.out))};return h.touch=m})},
"dojo/hccss":function(){define("require ./_base/config ./dom-class ./dom-style ./has ./domReady ./_base/window".split(" "),function(h,m,l,c,k,e,g){k.add("highcontrast",function(){var a=g.doc.createElement("div");a.style.cssText='border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("'+(m.blankGif||h.toUrl("./resources/blank.gif"))+'");';g.body().appendChild(a);var b=c.getComputedStyle(a),e=b.backgroundImage,b=b.borderTopColor==b.borderRightColor||
e&&("none"==e||"url(invalid-url:)"==e);8>=k("ie")?a.outerHTML="":g.body().removeChild(a);return b});e(function(){k("highcontrast")&&l.add(g.body(),"dj_a11y")});return k})},"dijit/_OnDijitClickMixin":function(){define("dojo/on dojo/_base/array dojo/keys dojo/_base/declare dojo/has ./a11yclick".split(" "),function(h,m,l,c,k,e){h=c("dijit._OnDijitClickMixin",null,{connect:function(c,a,b){return this.inherited(arguments,[c,"ondijitclick"==a?e:a,b])}});h.a11yclick=e;return h})},"*noref":1}});
define("esri/dijit/Legend","dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/json dojo/_base/Color dojo/debounce dojo/has dojo/sniff dojo/DeferredList dojo/json dojo/dom dojo/dom-construct dojo/dom-style dijit/_Widget dojox/gfx dojox/gfx/matrix dojox/html/entities ../kernel ../config ../request ../lang ../numberUtils ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/ClassBreaksRenderer ../renderers/ScaleDependentRenderer ../renderers/DotDensityRenderer ../renderers/TemporalRenderer ../renderers/VectorFieldRenderer ../renderers/HeatmapRenderer ../symbols/PictureFillSymbol ../symbols/SimpleLineSymbol ../symbols/jsonUtils ./_EventedWidget dojo/i18n!../nls/jsapi".split(" "),
function(h,m,l,c,k,e,g,a,b,r,y,I,t,d,p,w,x,z,v,s,B,G,D,E,J,N,H,K,V,W,S,X,Y,Z,Q,$,T){var O=m([$,w],{declaredClass:"esri.dijit.Legend",widgetsInTemplate:!1,layers:null,alignRight:!1,hoverLabelShowing:!1,dotDensitySwatchSize:26,dotCoverage:75,gradientHeight:30,transparencyRampColor:new g([64,64,64]),defaultText:"Aa",sizeRampLightColor:new g([255,255,255]),sizeRampDarkColor:new g([128,128,128]),gradientWidth:34,colorRampBorder:"1px solid",_specialChars:{lt:"\x3c",gt:"\x3e"},_ieTimer:100,_isRightToLeft:!1,
_align:null,_legendAlign:null,constructor:function(f,M){l.mixin(this,T.widgets.legend);this._i18n=T.widgets.legend;f=f||{};f.map?M?(this.map=f.map,this.layerInfos=f.layerInfos,this._respectCurrentMapScale=!1===f.respectCurrentMapScale?!1:!0,this._respectVisibility=!1===f.respectVisibility?!1:!0,this.arrangement=f.arrangement===O.ALIGN_RIGHT?O.ALIGN_RIGHT:O.ALIGN_LEFT,this.arrangement===O.ALIGN_RIGHT&&(this.alignRight=!0),this.autoUpdate=!1===f.autoUpdate?!1:!0,this._surfaceItems=[],this.hideLayersInLegend=
{},this.refresh=a(this.refresh,0)):console.error("esri.dijit.Legend: must specify a container for the legend"):console.error("esri.dijit.Legend: unable to find the 'map' property in parameters")},postMixInProperties:function(){this.inherited(arguments);var f=["ar","he"],a,b;for(a=0;a<f.length;a+=1)b=f[a],h.locale&&-1!==h.locale.indexOf(b)&&(-1!==h.locale.indexOf("-")?-1!==h.locale.indexOf(b+"-")&&(this._isRightToLeft=!0):this._isRightToLeft=!0);this._isRightToLeft?(this._align=this.alignRight?"left":
"right",this._legendAlign=this.alignRight?"esriLegendLeft":"esriLegendRight"):(this._align=this.alignRight?"right":"left",this._legendAlign=this.alignRight?"esriLegendRight":"esriLegendLeft")},startup:function(){this.inherited(arguments);this._initialize();9>b("ie")&&(this._repaintItems=l.hitch(this,this._repaintItems),setTimeout(this._repaintItems,this._ieTimer))},destroy:function(){this._deactivate();this._removeHoverHandlers();this.inherited(arguments)},refresh:function(f){if(this.domNode){f?(this.layerInfos=
f,this.layers=[],c.forEach(this.layerInfos,function(f){this._isSupportedLayerType(f.layer)&&(f.title&&(f.layer._titleForLegend=f.title),f.layer._hideDefaultSymbol=!1===f.defaultSymbol?!0:!1,f.hideLayers?(this.hideLayersInLegend[f.layer.id]=f.hideLayers,this._addSubLayersToHide(f)):this.hideLayersInLegend[f.layer.id]=[],f.hoverLabel&&(f.layer._hoverLabel=f.hoverLabel),f.hoverLabels&&(f.layer._hoverLabels=f.hoverLabels),this.layers.push(f.layer))},this)):this.useAllMapLayers&&(this.layers=this.layerInfos=
null);for(f=this.domNode.children.length-1;0<=f;f--)d.destroy(this.domNode.children[f]);this._removeHoverHandlers();this.startup()}},_legendUrl:"http://utility.arcgis.com/sharing/tools/legend",_initialize:function(){this.layerInfos&&(this.layers=[],c.forEach(this.layerInfos,function(f){this._isSupportedLayerType(f.layer)&&(f.title&&(f.layer._titleForLegend=f.title),f.layer._hideDefaultSymbol=!1===f.defaultSymbol?!0:!1,f.hideLayers?(this.hideLayersInLegend[f.layer.id]=f.hideLayers,this._addSubLayersToHide(f)):
this.hideLayersInLegend[f.layer.id]=[],f.hoverLabel&&(f.layer._hoverLabel=f.hoverLabel),f.hoverLabels&&(f.layer._hoverLabels=f.hoverLabels),this.layers.push(f.layer))},this));this.useAllMapLayers=!1;if(!this.layers){this.useAllMapLayers=!0;this.layers=[];var f=[],a=[];c.forEach(this.map.layerIds,function(b){b=this.map.getLayer(b);var A;this._isSupportedLayerType(b)&&(b.arcgisProps&&b.arcgisProps.title&&(b._titleForLegend=b.arcgisProps.title),this.layers.push(b));"esri.layers.KMLLayer"==b.declaredClass&&
(A=b.getLayers(),c.forEach(A,function(a){f.push(a.id)},this));"esri.layers.GeoRSSLayer"==b.declaredClass&&(A=b.getFeatureLayers(),c.forEach(A,function(f){a.push(f.id)},this))},this);c.forEach(this.map.graphicsLayerIds,function(b){var A=this.map.getLayer(b);-1==c.indexOf(f,b)&&-1==c.indexOf(a,b)&&(this._isSupportedLayerType(A)&&A._params&&A._params.drawMode)&&(A.arcgisProps&&A.arcgisProps.title&&(A._titleForLegend=A.arcgisProps.title),this.layers.push(A))},this)}this._createLegend()},_activate:function(){this._deactivate();
this.autoUpdate&&(this._respectCurrentMapScale&&(this._ozeConnect=k.connect(this.map,"onZoomEnd",this,"_refreshLayers")),this.useAllMapLayers&&(this._olaConnect=k.connect(this.map,"onLayerAdd",this,"_updateAllMapLayers"),this._olrConnect=k.connect(this.map,"onLayerRemove",this,"_updateAllMapLayers"),this._olroConnect=k.connect(this.map,"onLayersReordered",this,"_updateAllMapLayers")),c.forEach(this.layers,function(f){f.ovcConnect=k.connect(f,"onVisibilityChange",this,"_refreshLayers");f.oscConnect=
k.connect(f,"onScaleRangeChange",this,"_refreshLayers");"esri.layers.ArcGISDynamicMapServiceLayer"===f.declaredClass&&f.supportsDynamicLayers&&(f.odcConnect=k.connect(f,"_onDynamicLayersChange",l.hitch(this,"_updateDynamicLayers",f)));"esri.layers.ArcGISImageServiceLayer"===f.declaredClass&&(f.oirConnect=k.connect(f,"onRenderingChange",l.partial(this._updateImageServiceLayers,this,f)));"esri.layers.ArcGISImageServiceVectorLayer"===f.declaredClass&&(f.oivrConnect=k.connect(f,"onRendererChange",l.hitch(this,
"_refreshLayers")))},this))},_deactivate:function(){this._ozeConnect&&k.disconnect(this._ozeConnect);this._olaConnect&&k.disconnect(this._olaConnect);this._olroConnect&&k.disconnect(this._olroConnect);this._olrConnect&&k.disconnect(this._olrConnect);c.forEach(this.layers,function(f){f.ovcConnect&&k.disconnect(f.ovcConnect);f.oscConnect&&k.disconnect(f.oscConnect);f.odcConnect&&k.disconnect(f.odcConnect);f.oirConnect&&k.disconnect(f.oirConnect);f.oivrConnect&&k.disconnect(f.oivrConnect)},this)},_updateDynamicLayers:function(f){delete f.legendResponse;
this._refreshLayers()},_updateImageServiceLayers:function(f,a){delete a.legendResponse;f._refreshLayers()},_refreshLayers:function(){this.refresh()},_updateAllMapLayers:function(){this.layers=[];c.forEach(this.map.layerIds,function(f){f=this.map.getLayer(f);this._isSupportedLayerType(f)&&this.layers.push(f)},this);c.forEach(this.map.graphicsLayerIds,function(f){f=this.map.getLayer(f);this._isSupportedLayerType(f)&&(f._params&&f._params.drawMode)&&this.layers.push(f)},this);this.refresh()},_createLegend:function(){var f=
!1;p.set(this.domNode,"position","relative");d.create("div",{id:this.id+"_msg",className:"esriLegendMsg",innerHTML:this.NLS_creatingLegend+"..."},this.domNode);var a=[];c.forEach(this.layers,function(b){if("esri.layers.KMLLayer"==b.declaredClass||"esri.layers.GeoRSSLayer"==b.declaredClass){var C;b.loaded?("esri.layers.KMLLayer"==b.declaredClass?C=b.getLayers():"esri.layers.GeoRSSLayer"==b.declaredClass&&(C=b.getFeatureLayers(),this.hideLayersInLegend[b.id]&&(C=c.filter(C,function(f){return-1==c.indexOf(this.hideLayersInLegend[b.id],
f.id)},this))),c.forEach(C,function(f){"esri.layers.FeatureLayer"==f.declaredClass&&b._titleForLegend&&(f._titleForLegend=b._titleForLegend+" - ","esriGeometryPoint"==f.geometryType?f._titleForLegend+=this.NLS_points:"esriGeometryPolyline"==f.geometryType?f._titleForLegend+=this.NLS_lines:"esriGeometryPolygon"==f.geometryType&&(f._titleForLegend+=this.NLS_polygons),a.push(f))},this)):k.connect(b,"onLoad",l.hitch(this,function(){this.refresh(this.layerInfos)}))}else if("esri.layers.WMSLayer"===b.declaredClass)if(b.loaded){if((!this._respectVisibility||
this._respectVisibility&&b.visible)&&0<b.layerInfos.length&&c.some(b.layerInfos,function(f){return f.legendURL})){var U=!1;c.forEach(b.layerInfos,function(a){a.legendURL&&-1<c.indexOf(b.visibleLayers,a.name)&&(U||(d.create("div",{innerHTML:"\x3cspan class\x3d'esriLegendServiceLabel'\x3e"+(b._titleForLegend||b.name||b.id)+"\x3c/span\x3e"},this.domNode),U=!0),d.create("div",{innerHTML:"\x3cimg src\x3d'"+a.legendURL+"'/\x3e"},this.domNode),f=!0)},this)}}else k.connect(b,"onLoad",l.hitch(this,function(){this.refresh(this.layerInfos)}));
else a.push(b)},this);var b=[];c.forEach(a,function(f){if(f.loaded){if((!this._respectVisibility||this._respectVisibility&&f.visible)&&(f.layerInfos||f.renderer||"esri.layers.ArcGISImageServiceLayer"==f.declaredClass)){var a=d.create("div",{id:this.id+"_"+f.id,style:{display:"none"},"class":"esriLegendService"});d.create("span",{innerHTML:this._getServiceTitle(f),"class":"esriLegendServiceLabel"},d.create("td",{align:this._align},d.create("tr",{},d.create("tbody",{},d.create("table",{width:"95%"},
a)))));d.place(a,this.id,"first");f.legendResponse||f.renderer?this._createLegendForLayer(f):b.push(this._legendRequest(f))}}else var M=k.connect(f,"onLoad",this,function(f){k.disconnect(M);M=null;this.refresh()})},this);0===b.length&&!f?(t.byId(this.id+"_msg").innerHTML=this.NLS_noLegend,this._activate()):(new y(b)).addCallback(l.hitch(this,function(a){f?t.byId(this.id+"_msg").innerHTML="":t.byId(this.id+"_msg").innerHTML=this.NLS_noLegend;this._activate()}))},_createLegendForLayer:function(f){if(f.legendResponse||
f.renderer){var a=!1;if(f.legendResponse){var b=f.dynamicLayerInfos||f.layerInfos;b&&b.length?c.forEach(b,function(b,C){if(!this.hideLayersInLegend[f.id]||-1==c.indexOf(this.hideLayersInLegend[f.id],b.id)){var d=this._buildLegendItems(f,b,C);a=a||d}},this):"esri.layers.ArcGISImageServiceLayer"==f.declaredClass&&(a=this._buildLegendItems(f,{id:0,name:null,title:f.name,subLayerIds:null,parentLayerId:-1},0))}else f.renderer&&(b=f.url?f.url.substring(f.url.lastIndexOf("/")+1,f.url.length):"fc_"+f.id,
a=this._buildLegendItems(f,{id:b,name:null,subLayerIds:null,parentLayerId:-1},0));a&&(p.set(t.byId(this.id+"_"+f.id),"display","block"),p.set(t.byId(this.id+"_msg"),"display","none"))}},_legendRequest:function(f){if(f.loaded)return 10.01<=f.version?this._legendRequestServer(f):this._legendRequestTools(f);k.connect(f,"onLoad",l.hitch(this,"_legendRequest"))},_legendRequestServer:function(f){var a=f.url,b=a.indexOf("?"),a=-1<b?a.substring(0,b)+"/legend"+a.substring(b):a+"/legend";(b=f._getToken())&&
(a+="?token\x3d"+b);var A=l.hitch(this,"_processLegendResponse"),d={f:"json"};f._params.dynamicLayers&&(d.dynamicLayers=I.stringify(this._createDynamicLayers(f)),"[{}]"===d.dynamicLayers&&(d.dynamicLayers="[]"));f._params.bandIds&&(d.bandIds=f._params.bandIds);f._params.renderingRule?d.renderingRule=f._params.renderingRule:f.rasterFunctionInfos&&0<f.rasterFunctionInfos.length&&c.forEach(f.rasterFunctionInfos,function(f){f&&(f.name&&"none"===f.name.toLowerCase())&&(d.renderingRule=I.stringify({rasterFunction:f.name}))});
return G({url:a,content:d,callbackParamName:"callback",load:function(a,b){A(f,a,b)},error:B.defaults.io.errorHandler})},_legendRequestTools:function(f){var a=f.url.toLowerCase().indexOf("/rest/"),a=f.url.substring(0,a)+f.url.substring(a+5,f.url.length),a=this._legendUrl+"?soapUrl\x3d"+window.escape(a);if(!b("ie")||8<b("ie"))a+="\x26returnbytes\x3dtrue";var c=l.hitch(this,"_processLegendResponse");return G({url:a,content:{f:"json"},callbackParamName:"callback",load:function(a,b){c(f,a,b)},error:B.defaults.io.errorHandler})},
_processLegendResponse:function(f,a){a&&a.layers?(f.legendResponse=a,t.byId(this.id+"_"+f.id)&&d.empty(t.byId(this.id+"_"+f.id)),d.create("span",{innerHTML:this._getServiceTitle(f),"class":"esriLegendServiceLabel"},d.create("td",{align:this._align},d.create("tr",{},d.create("tbody",{},d.create("table",{width:"95%"},t.byId(this.id+"_"+f.id)))))),this._createLegendForLayer(f)):console.log("Legend could not get generated for "+f.url+": "+e.toJson(a))},_buildLegendItems:function(f,a,b){var c=!1,q=t.byId(this.id+
"_"+f.id),e=a.parentLayerId;if(a.subLayerIds)f=d.create("div",{id:this.id+"_"+f.id+"_"+a.id+"_group",style:{display:"none"},"class":-1==e?0<b?"esriLegendGroupLayer":"":this._legendAlign},-1==e?q:t.byId(this.id+"_"+f.id+"_"+e+"_group")),d.create("td",{innerHTML:v.encode(a.name),align:this._align},d.create("tr",{},d.create("tbody",{},d.create("table",{width:"95%","class":"esriLegendLayerLabel"},f))));else{if(this._respectVisibility&&f.visibleLayers&&-1==(","+f.visibleLayers+",").indexOf(","+a.id+","))return c;
b=d.create("div",{id:this.id+"_"+f.id+"_"+a.id,style:{display:"none"},"class":-1<e?this._legendAlign:""},-1==e?q:t.byId(this.id+"_"+f.id+"_"+e+"_group"));d.create("td",{innerHTML:v.encode(a.name)||"",align:this._align},d.create("tr",{},d.create("tbody",{},d.create("table",{width:"95%","class":"esriLegendLayerLabel"},b))));f.legendResponse?c=c||this._buildLegendItems_Tools(f,a,b):f.renderer&&(c=c||this._buildLegendItems_Renderer(f,a,b))}return c},_buildLegendItems_Tools:function(f,a,b){var A=a.parentLayerId,
q=this.map.getScale(),e=!1,g=function(f,a){var b,c;for(b=0;b<f.length;b++)if(a.dynamicLayerInfos)for(c=0;c<a.dynamicLayerInfos[c].length;c++){if(a.dynamicLayerInfos[c].mapLayerId==f[b].layerId)return f[b]}else if(a.id==f[b].layerId)return f[b];return{}};if(!this._respectCurrentMapScale||this._respectCurrentMapScale&&this._isLayerInScale(f,a,q)){var l=!0;if(this._respectCurrentMapScale&&("esri.layers.ArcGISDynamicMapServiceLayer"===f.declaredClass||"esri.layers.ArcGISMapServiceLayer"===f.declaredClass)){var u=
this._getEffectiveScale(f,a);if(u.minScale&&u.minScale<q||u.maxScale&&u.maxScale>q)l=!1}if(l){var q=g(f.legendResponse.layers,a),k=q.legendType,n=q.legend;if(n){"esri.layers.ArcGISImageServiceLayer"!==f.declaredClass&&this._sanitizeLegendResponse(f,q,a);b=d.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},b);var h=d.create("tbody",{},b);(f._hoverLabel||f._hoverLabels)&&this._createHoverAction(b,f,a);c.forEach(n,function(b){if(!(10.1<=f.version&&!b.values&&1<n.length&&
(f._hideDefaultSymbol||"\x3call other values\x3e"===b.label||!b.label&&!("esri.layers.ArcGISImageServiceLayer"===f.declaredClass&&10.3<=f.version))))if(b.url&&0===b.url.indexOf("http")||b.imageData&&0<b.imageData.length)e=!0,this._buildRow_Tools(b,h,f,a.id,k)},this)}}}e&&(p.set(t.byId(this.id+"_"+f.id+"_"+a.id),"display","block"),-1<A&&(p.set(t.byId(this.id+"_"+f.id+"_"+A+"_group"),"display","block"),this._findParentGroup(f.id,f,A)));return e},_sanitizeLegendResponse:function(f,a,b){var d=a.legend;
if(10.1<=f.version&&1<d.length&&!a._sanitized){f=l.getObject("layerDefinition.drawingInfo.renderer",!1,b);var q,e;f||(f=l.getObject("drawingInfo.renderer",!1,b));c.some(d,function(f){if(f.values)return!0})&&c.some(d,function(f,a){f.values||(e=a,q=f);return!!q});f?"uniqueValue"===f.type?q&&(d.splice(e,1),d.push(q)):"classBreaks"===f.type&&(q&&d.splice(e,1),d.reverse(),q&&d.push(q)):q&&(d.splice(e,1),d.push(q));a._sanitized=!0}},_buildRow_Tools:function(f,a,c,A,q){var e=d.create("tr",{},a),g;this.alignRight?
(a=d.create("td",{align:this._isRightToLeft?"left":"right"},e),g=d.create("td",{align:this._isRightToLeft?"left":"right",width:35},e)):(g=d.create("td",{width:35,align:"center"},e),a=d.create("td",{},e));e=f.url;(!b("ie")||9<=b("ie")||9>b("ie")&&"esri.layers.ArcGISImageServiceLayer"===c.declaredClass)&&f.imageData&&0<f.imageData.length?e="data:image/png;base64,"+f.imageData:0!==f.url.indexOf("http")&&(e=c.url+"/"+A+"/images/"+f.url,(A=c._getToken())&&(e+="?token\x3d"+A));A=d.create("img",{src:e,border:0,
style:"opacity:"+c.opacity},g);f=d.create("td",{innerHTML:v.encode(f.label),align:this._align},d.create("tr",{},d.create("tbody",{},d.create("table",{width:"95%",dir:"ltr"},a))));q&&("Stretched"===q&&10.3<=c.version&&"esri.layers.ArcGISImageServiceLayer"===c.declaredClass)&&(f.style.verticalAlign="top",f.style.lineHeight="1",A.style.marginBottom="-1px",A.style.display="block",a.style.verticalAlign="top");9>b("ie")&&(A.style.filter="alpha(opacity\x3d"+100*c.opacity+")")},_getVariable:function(f,a,
b){var c;f&&(c=(f=f.getVisualVariablesForType(a,b))&&f[0]);return c},_getVariables:function(f,a,b){f=[this._getVariable(f,"colorInfo",!1),this._getVariable(f,"opacityInfo",!1),this._getVariable(f,"sizeInfo",!1)];return a?c.filter(f,function(f){return!(!f||!(f.field===a&&f.normalizationField==b))}):f},_getFieldAlias:function(f,a){var b=a.infoTemplate,b=b&&b.getFieldInfo&&b.getFieldInfo(f),c=l.isFunction(f)?null:a.getField(f),d=b||c,e="";d&&(e=b&&b.label||c&&c.alias||d.name||d.fieldName);return e},
_getRampTitle:function(f,a){var b,c=f.field,d=f.normalizationField,e=!1,g=!1,k=!1,u,c=l.isFunction(c)?null:c,d=l.isFunction(d)?null:d;if(a.renderer.authoringInfo&&a.renderer.authoringInfo.visualVariables){var h=a.renderer.authoringInfo.visualVariables;for(u=0;u<h.length;u++){var n=h[u];if("colorInfo"===n.type&&"ratio"===n.style){e=!0;break}else if("colorInfo"===n.type&&"percent"===n.style){g=!0;break}else if("colorInfo"===n.type&&"percentTotal"===n.style){k=!0;break}}}(e=k&&"showRatioPercentTotal"||
g&&"showRatioPercent"||e&&"showRatio"||d&&"showNormField"||c&&"showField"||null)&&(b=D.substitute({field:c&&this._getFieldAlias(c,a),normField:d&&this._getFieldAlias(d,a)},this._i18n[e]));return b},_getRendererTitle:function(a,b){var c;if(a){var d,e,g;a instanceof H&&(d=a.attributeField,e=a.normalizationField,g="percent-of-total"===a.normalizationType);d=l.isFunction(d)?null:d;(g=(e=l.isFunction(e)?null:e)&&"showNormField"||(g?"showNormPct":null)||d&&"showField"||null)&&(c=D.substitute({field:d&&
this._getFieldAlias(d,b),normField:e&&this._getFieldAlias(e,b)},this._i18n[g]))}return c},_buildLegendItems_Renderer:function(a,b,C){var e=b.parentLayerId,q=this.map,g=q.getScale(),P,k=!1;if(!this._respectCurrentMapScale||this._isLayerInScale(a,b,g)){var u,h,n="esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass?a.renderer.renderer:a.renderer,m,L,r,s,w;if(n instanceof K&&(n=(n="zoom"===n.rangeType?n.getRendererInfoByZoom(q.getZoom()):n.getRendererInfoByScale(g))&&n.renderer,!n))return!1;
var F=this._getVariables(n),y=c.filter(F,function(a){return!!a}).length,q=F[0],g=F[1],F=F[2],x,z;q&&(m=this._getMedianColor(n,q),q.field&&(r=l.isFunction(q.field)?null:a.getField(q.field)));g&&g.field&&(w=l.isFunction(g.field)?null:a.getField(g.field));F&&F.field&&(s=l.isFunction(F.field)?null:a.getField(F.field));if(n instanceof X)P=k=!0,this._showHeatRamp(a,b,n,C);else if(n instanceof V)P=k=!0,this._showDotDensityLegend(a,b,n,C);else if(n instanceof W)P=k=!0,h=d.create("table",{cellpadding:0,cellspacing:0,
width:"95%","class":"esriLegendLayer"},C),u=d.create("tbody",{},h),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(h,a,b),n.latestObservationRenderer&&n.latestObservationRenderer instanceof J&&this._buildRow_Renderer(a,n.latestObservationRenderer.symbol,m,v.encode(n.latestObservationRenderer.label)||this.NLS_currentObservations,null,u),n.observationRenderer&&n.observationRenderer instanceof J&&this._buildRow_Renderer(a,n.observationRenderer.symbol,m,v.encode(n.observationRenderer.label)||
this.NLS_previousObservations,null,u);else if(n instanceof N){if(n.infos&&0<n.infos.length){P=k=!0;h=d.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},C);u=d.create("tbody",{},h);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(h,a,b);n.attributeField&&F&&this._addSubHeader(u,this._getFieldAlias(n.attributeField,a));var B=[];c.forEach(n.infos,function(b){var d=null;a._editable&&a.types&&(d=this._getTemplateFromTypes(a.types,b.value));var M=b.label;null==
M&&(M=b.value);-1===c.indexOf(B,M)&&(B.push(M),this._buildRow_Renderer(a,b.symbol,m,v.encode(M),d,u))},this)}z=this._displayDefaultSymbol(a,n,C)}else if(n instanceof H){if(n.infos&&0<n.infos.length||"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass){P=k=!0;x=this._isUnclassedRenderer(n);!q&&1===n.infos.length&&(L=(L=n.infos[0])&&L.symbol);x||(h=d.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},C),u=d.create("tbody",{},h),y=this._getRendererTitle(n,a),
this._buildRow_Renderer(a,null,m,v.encode(y),null,u));h=d.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},C);u=d.create("tbody",{},h);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(h,a,b);if(!x||!F)y=n.infos.slice(0).reverse(),c.forEach(y,function(b){var c=b.label;null==c&&!x&&(c=b.minValue+" - "+b.maxValue);this._buildRow_Renderer(a,b.symbol,m,v.encode(c),null,u)},this);if("esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass&&(a.renderer.style===
S.STYLE_SCALAR||a.renderer.style===S.STYLE_SINGLE_ARROW))this._buildRow_Renderer(a,n.defaultSymbol,null,"",null,u),a._hideDefaultSymbol=!0}x||(z=this._displayDefaultSymbol(a,n,C))}else n instanceof J&&(P=k=!0,h=d.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},C),u=d.create("tbody",{},h),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(h,a,b),L=null,a._editable&&(a.templates&&0<a.templates.length)&&(L=a.templates[0]),h=1<y?null:r||w||s,this._buildRow_Renderer(a,
n.symbol,m,v.encode(h?this._getRampTitle(1<y?null:q||g||F,a):n.label),L,u),L=q?null:n.symbol,h&&(r=w=s=null));P&&(q&&q.field&&this._showGradientRamp(a,b,n,null,C,q,r),F&&F.field&&this._showSizeLegend(a,b,n,F,m,C,s),g&&g.field&&this._showGradientRamp(a,b,n,L&&!L.url&&L.color?L.color:this.transparencyRampColor,C,g,w));z||(z=this._displayDefaultSymbol(a,n,C));k=k||z}k&&(p.set(t.byId(this.id+"_"+a.id+"_"+b.id),"display","block"),-1<e&&(p.set(t.byId(this.id+"_"+a.id+"_"+e+"_group"),"display","block"),
this._findParentGroup(a.id,e)));return k},_isUnclassedRenderer:function(a,b){var c;if(a instanceof H&&a.infos&&1===a.infos.length){c=a.attributeField;var d=a.normalizationField;c=b?c===b:!!this._getVariables(a,c,d).length}return c},_displayDefaultSymbol:function(a,b,c){var e;!a._hideDefaultSymbol&&b.defaultSymbol&&(e=!0,c=d.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c),c=d.create("tbody",{},c),this._buildRow_Renderer(a,b.defaultSymbol,null,v.encode(b.defaultLabel)||
"others",null,c));return e},_showGradientRamp:function(a,b,c,e,g,l,k,h){var u;u=d.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},g);g=d.create("tbody",{},u);(a._hoverLabel||a._hoverLabels||h)&&this._createHoverAction(u,a,b,h);k&&this._addSubHeader(g,this._getRampTitle(l,a));(b=this._getRampStops(c,l,e))&&b.length&&this._drawGradientRamp(g,b,!0,a,this._getRampBorderColor(c),!!e)},_getMedianColor:function(a,b){var c,d;b.colors?(c=b.minDataValue,d=b.maxDataValue):
b.stops&&(c=b.stops[0].value,d=b.stops[b.stops.length-1].value);return a.getColor(c+(d-c)/2,{colorInfo:b})},_getRampStops:function(a,b,d){var e,q,l,k,h=!1;b.colors||b.opacityValues?(q=b.maxDataValue-b.minDataValue,e=c.map([0,0.25,0.5,0.75,1],function(a){l=b.minDataValue+a*q;return Number(l.toFixed(6))}),this._checkPrecision(0,4,e)):b.stops&&(e=c.map(b.stops,function(a){return a.value}),(h=c.some(b.stops,function(a){return!!a.label}))&&(k=c.map(b.stops,function(a){return a.label})));var u=e[0],m,n,
p;q=e[e.length-1]-u;return c.map(e,function(c,l){d?(m=new g(d.toRgba()),n=a.getOpacity(c,{opacityInfo:b}),null!=n&&(m.a=n)):m=a.getColor(c,{colorInfo:b});p="";0===l?p=this._specialChars.lt+" ":l===e.length-1&&(p=this._specialChars.gt+" ");return{value:c,color:m,offset:1-(c-u)/q,label:h?k[l]:p+E.format(c)}},this).reverse()},_checkPrecision:function(a,b,c){var d=a+(b-a)/2,e=c[a],g=c[d],l=c[b],k=Math.floor(e),h=Math.floor(g),m=Math.floor(l);k===e&&(m===l&&h!==g&&k!==h&&m!==h)&&(c[d]=h);a+1!==d&&this._checkPrecision(a,
d,c);d+1!==b&&this._checkPrecision(d,b,c)},_getRampBorderColor:function(a){var b;if(a instanceof J)b=a.symbol;else if(a instanceof N||a instanceof H)b=a.infos[0].symbol;return(a=b&&-1===b.type.indexOf("linesymbol")?b.getStroke():null)&&a.color},_drawGradientRamp:function(a,e,C,l,q,k){var h=d.create("tr",{},a),m,u,R,n,t,r=e.length-1,s;n=0;this.alignRight?(a=d.create("td",{align:this._isRightToLeft?"left":"right"},h),m=d.create("td",{align:this._isRightToLeft?"left":"right",width:this.gradientWidth},
h)):(m=d.create("td",{width:this.gradientWidth,align:"center"},h),a=d.create("td",{},h));h=q&&0<q.a&&!(240<=q.r&&240<=q.g&&240<=q.b);u=d.create("div",{"class":h?"":"esriLegendBorderLessColorRamp",style:"position: relative; width:"+this.gradientWidth+"px;"},m);m=d.create("div",{"class":"esriLegendColorRamp"+(k?" esriLegendTransparencyRamp":"")},u);k=p.get(m,"width");h&&(q=9>b("ie")?q.toHex():"rgba("+q.toRgba().join(",")+")",p.set(m,"border",this.colorRampBorder+" "+q));C?(q=this.gradientHeight*r,p.set(m,
"height",q+"px")):q=p.get(m,"height");p.set(u,"height",q+"px");h=x.createSurface(m,k,q);9>b("ie")&&(n=h.getEventSource(),p.set(n,"position","relative"),p.set(n.parentNode,"position","relative"),n=1);try{C&&c.forEach(e,function(a,b){a.offset=b/r}),t=h.createRect({x:-n,y:-n,width:k+n,height:q+n}),t.setFill({type:"linear",x1:0,y1:0,x2:0,y2:q,colors:e}).setStroke(null),h.createRect({width:k,height:q}).setFill(new g([255,255,255,1-l.opacity])).setStroke(null),this._surfaceItems.push(h)}catch(w){h.clear(),
h.destroy()}c.forEach(e,function(a,b){if(a.label){s="top:"+100*a.offset+"%;";var f="";0===b&&(f+=" esriLegendColorRampTickFirst");b===e.length-1&&(f+=" esriLegendColorRampTickLast");d.create("div",{"class":"esriLegendColorRampTick"+f,innerHTML:"\x26nbsp;",style:s},u)}});R=d.create("div",{"class":"esriLegendColorRampLabels",style:{height:q+this.gradientHeight+"px"}},a);C?c.forEach(e,function(a){d.create("div",{"class":"esriLegendColorRampLabel",innerHTML:v.encode(a.label)||"\x26nbsp;"},R)}):(d.create("div",
{"class":"esriLegendColorRampLabel",innerHTML:this._i18n.high},R),d.create("div",{"class":"esriLegendColorRampLabel",innerHTML:this._i18n.low,style:"top: "+(q+this.gradientHeight-2*this.gradientHeight)+"px;"},R))},_showHeatRamp:function(a,b,c,e,g){var l,k=c.field;l=d.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},e);e=d.create("tbody",{},l);(a._hoverLabel||a._hoverLabels||g)&&this._createHoverAction(l,a,b,g);(k=k&&a.getField(k))&&this._addSubHeader(e,this._getFieldAlias(k.name,
a));b=this._getHeatmapStops(c);b.length&&this._drawGradientRamp(e,b,!1,a)},_getHeatmapStops:function(a){var b=a.colorStops;a=a.colors;var d,e,g,l;if(b&&b[0])if(d=b.length-1,a=b[0]&&null!=b[0].ratio){if((a=b[d])&&1!==a.ratio)b=b.slice(0),b.push({ratio:1,color:a.color}),d++}else e=b[0].value,g=b[d].value-e,b=c.map(b,function(a){return{color:a.color,ratio:(a.value-e)/g}});else a&&a[0]&&(d=a.length-1,l=1/(a.length-1),b=c.map(a,function(a,b){return{color:a,ratio:b*l}}));b=c.map(b,function(a,b){var f="";
0===b?f="Low":b===d&&(f="High");return{color:a.color,label:f,offset:1-a.ratio}});return b.reverse()},_showDotDensityLegend:function(a,b,e,g){var q=e.legendOptions,k,h,m,u,p,n,t,r=this.dotDensitySwatchSize,s=Math.round(r/2);q&&(h=q.backgroundColor,m=q.outline,u=q.valueUnit,p=q.dotCoverage);p=(p||this.dotCoverage)/100;t=Math.round(r*r/Math.pow(e.dotSize,2)*p);g=d.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},g);n=d.create("tbody",{},g);(a._hoverLabel||a._hoverLabels)&&
this._createHoverAction(g,a,b);this._addSubHeader(n,D.substitute({value:e.dotValue,unit:u||""},this.NLS_dotValue));c.forEach(e.fields,function(b){b=l.mixin({},b);b.numPoints=t;k=new Y(e._generateImageSrc(r,r,[b],{x:0,y:0},{x:r,y:r},h),m||e.outline,r,r);b=a.getField(b.name)||b;this._buildRow_Renderer(a,k,null,v.encode(this._getFieldAlias(b.name,a)),null,n,{type:"path",path:"M "+-s+","+-s+" L "+s+","+-s+" L "+s+","+s+" L "+-s+","+s+" L "+-s+","+-s+" E"})},this)},_showSizeLegend:function(a,b,c,e,g,l,
k,h){var m=e.legendOptions,m=m&&m.customValues,p;g=this._getSizeSymbol(c,g);if(!(e.valueUnit&&"unknown"!==e.valueUnit||!g||!m&&(null==e.minSize||null==e.maxSize))){p=d.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},l);l=d.create("tbody",{},p);(a._hoverLabel||a._hoverLabels||h)&&this._createHoverAction(p,a,b,h);k&&this._addSubHeader(l,this._getRampTitle(e,a));b=m||this._getDataValues(c,g,e);for(k=p=b.length-1;0<=k;k--)h=b[k],g=Q.fromJson(g.toJson()),this._applySize(g,
c,e,h),h=E.format(h),m="",k===p?m=this._specialChars.gt+" ":0===k&&(m=this._specialChars.lt+" "),m="\x3cspan class\x3d'esriLegendSizeRampLabel'\x3e"+v.encode(m+h)+"\x3c/span\x3e",this._buildRow_Renderer(a,g,null,m,null,l)}},_getSizeSymbol:function(a,b){var c,d;if(a instanceof J)c=a.symbol;else if(a instanceof S)c=a.defaultSymbol;else if(a instanceof N||a instanceof H)c=a.infos[0].symbol,d=1<a.infos.length;if(c=c&&-1!==c.type.indexOf("fillsymbol")?null:c)if(c=Q.fromJson(c.toJson()),b||d)-1!==c.type.indexOf("linesymbol")?
c.setColor(new g(this.sizeRampDarkColor)):(c.setColor(new g(this.sizeRampLightColor)),c.setOutline&&(d=new Z,d.setColor(new g(this.sizeRampDarkColor)),d.setWidth(1.5),c.setOutline(d)));return c},_getDataValues:function(a,b,d,e,g){e=null==e?5:e;g=null==g?20:g;var l=a.getSizeRangeAtScale(d,this.map.getScale());e=this._interpolateSizeRange(l,e);var k=c.map(e,function(a){return this._getDataValueFromSize(a,d,l)},this),h,m,k=E.round(k);for(h=1;h<k.length-1;h++)if(m=this._roundDataValue(a,b,d,k[h],k[h-
1],g))k[h]=m[0],e[h]=m[1];return k},_interpolateSizeRange:function(a,b){var c=a.minSize,d=(a.maxSize-c)/(b-1),e,g=[];for(e=0;e<b;e++)g.push(c+d*e);return g},_getDataValueFromSize:function(a,b,c){var d=c.minSize;c=c.maxSize;var e=b.minDataValue;b=b.maxDataValue;return a=a<=d?e:a>=c?b:(a-d)/(c-d)*(b-e)+e},_roundDataValue:function(a,b,c,d,e,g){var l=this._getSize(b,a,c,d);e=this._getSize(b,a,c,e);var k,h=E.getDigits(d),m=h.integer,h=h.fractional,n,p,r,s,t,v,w,y,x,z,B;0<d&&1>d&&(k=Math.pow(10,h),d*=k,
m=E.getDigits(d).integer);for(m-=1;0<=m&&!(n=Math.pow(10,m),h=Math.floor(d/n)*n,n*=Math.ceil(d/n),null!=k&&(h/=k,n/=k),p=(h+n)/2,p=E.round([h,p,n],{indexes:[1]})[1],r=this._getSize(b,a,c,h),s=this._getSize(b,a,c,n),t=this._getSize(b,a,c,p),v=E.getPctChange(l,r,e,null),w=E.getPctChange(l,s,e,null),y=E.getPctChange(l,t,e,null),x=v.prev<=g,z=w.prev<=g,x&&z&&(v.prev<=w.prev?(x=!0,z=!1):(z=!0,x=!1)),x?B=[h,r]:z?B=[n,s]:y.prev<=g&&(B=[p,t]),B);m--);return B},_applySize:function(a,b,c,d){var e=a.type;b=
this._getSize(a,b,c,d);switch(e){case "simplemarkersymbol":a.setSize(b);break;case "picturemarkersymbol":e=a.width;c=a.height;a.setHeight(b);a.setWidth(b*(e/c));break;case "simplelinesymbol":case "cartographiclinesymbol":a.setWidth(b);break;case "textsymbol":a.font&&a.font.setSize(b)}},_getSize:function(a,b,c,d){return b.getSize(d,{sizeInfo:c,scale:this.map.getScale(),shape:-1!==a.type.indexOf("markersymbol")?a.style:null})},_buildRow_Renderer:function(a,b,c,e,g,l,k){var h=d.create("tr",{},l),m;this.alignRight?
(l=d.create("td",{align:this._isRightToLeft?"left":"right"},h),b&&(m=d.create("td",{align:this._isRightToLeft?"left":"right",width:35},h))):(b&&(m=d.create("td",{width:35,align:"center"},h)),l=d.create("td",{},h));var p=h=30,n;if(b){if("simplemarkersymbol"==b.type)h=Math.min(Math.max(h,b.size+12),125),p=Math.min(Math.max(p,b.size+12),125);else if("picturemarkersymbol"==b.type)h=Math.min(Math.max(h,b.width),125),p=Math.min(b.height||p,125);else if("textsymbol"==b.type){var r,s;b.text||(r=b.text,s=
!0,b.setText(this.defaultText));h=Math.min(Math.max(h,b.getWidth()+12),125);p=Math.min(Math.max(p,b.getHeight()+12),125);s&&b.setText(r)}n=d.create("div",{style:"width:"+h+"px;height:"+p+"px;"},m)}D.isDefined(e)&&"number"===typeof e&&(e=""+e);d.create("td",{innerHTML:e||"",align:this._align},d.create("tr",{},d.create("tbody",{},d.create("table",{width:"95%"},l))));b&&(a=this._drawSymbol(n,b,c,h,p,g,a,k),this._surfaceItems.push(a))},_addSubHeader:function(a,b){var c=d.create("tr",{},a),c=d.create("td",
{align:this._align,colspan:2},c);d.create("td",{innerHTML:v.encode(b)||"",align:this._align},d.create("tr",{},d.create("tbody",{},d.create("table",{width:"95%"},c))))},_drawSymbol:function(a,c,d,e,h,k,m,r){c=Q.fromJson(c.toJson());var u=m.opacity;d&&c.setColor(new g(d.toRgba()));if("simplelinesymbol"===c.type||"cartographiclinesymbol"===c.type||"textsymbol"===c.type){if(!c.color)return;d=c.color.toRgba();d[3]*=u;c.color.setColor(d)}else"simplemarkersymbol"===c.type||"simplefillsymbol"===c.type?(c.color&&
(d=c.color.toRgba(),d[3]*=u,c.color.setColor(d)),c.outline&&c.outline.color&&(d=c.outline.color.toRgba(),d[3]*=u,c.outline.color.setColor(d))):"picturemarkersymbol"===c.type&&(a.style.opacity=u,a.style.filter="alpha(opacity\x3d("+100*u+"))");a=x.createSurface(a,e,h);9>b("ie")&&(d=a.getEventSource(),p.set(d,"position","relative"),p.set(d.parentNode,"position","relative"));k=this._getDrawingToolShape(c,k)||Q.getShapeDescriptors(c);var s,u=(d=k.defaultShape)&&"text"===d.type;try{u&&!d.text&&(d.text=
this.defaultText),s=a.createShape(r||d).setFill(k.fill).setStroke(k.stroke),u&&s.setFont(k.font)}catch(n){a.clear();a.destroy();return}var t=s.getBoundingBox();r=t.width;k=t.height;var u=-(t.x+r/2),v=-(t.y+k/2);d=a.getDimensions();u={dx:u+d.width/2,dy:v+d.height/2};if("simplemarkersymbol"===c.type&&"path"===c.style)e=m._getScaleMatrix(t,c.size),s.applyTransform(z.scaleAt(e.xx,e.yy,{x:d.width/2,y:d.height/2}));else if(r>e||k>h)m=r/e>k/h,e=((m?e:h)-5)/(m?r:k),l.mixin(u,{xx:e,yy:e});s.applyTransform(u);
return a},_getDrawingToolShape:function(a,b){var c;switch(b?b.drawingTool||null:null){case "esriFeatureEditToolArrow":c={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 E"};break;case "esriFeatureEditToolTriangle":c={type:"path",path:"M -10,14 L 2,-10 L 14,14 L -10,14 E"};break;case "esriFeatureEditToolRectangle":c={type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 E"};break;case "esriFeatureEditToolCircle":c={type:"circle",cx:0,cy:0,r:10};break;case "esriFeatureEditToolEllipse":c=
{type:"ellipse",cx:0,cy:0,rx:10,ry:5};break;default:return null}return{defaultShape:c,fill:a.getFill(),stroke:a.getStroke()}},_repaintItems:function(){c.forEach(this._surfaceItems,function(a){this._repaint(a)},this)},_repaint:function(a){if(a){a.getStroke&&a.setStroke&&a.setStroke(a.getStroke());try{a.getFill&&a.setFill&&a.setFill(a.getFill())}catch(b){}a.children&&l.isArray(a.children)&&c.forEach(a.children,this._repaint,this)}},_createHoverAction:function(a,b,c,e){if(e=b._hoverLabel||b._hoverLabels&&
b._hoverLabels[c.id]||e)e=v.encode(e),b.mouseMoveHandler=b.mouseMoveHandler||{},b.mouseMoveHandler[c.id]=k.connect(a,"onmousemove",l.hitch(this,function(a,b){this.mouseX=b.clientX;this.mouseY=b.clientY;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,p.set(t.byId(this.id+"_hoverLabel"),"display","none"));setTimeout(l.hitch(this,function(a,b,c){if(a==this.mouseX&&b==this.mouseY&&!this.hoverLabelShowing)if(this.hoverLabelShowing=!0,t.byId(this.id+"_hoverLabel")){var f=t.byId(this.id+"_hoverLabel");
f.innerHTML="\x3cspan\x3e"+c+"\x3c/span\x3e";p.set(f,"top",b+"px");p.set(f,"left",a+15+"px");p.set(f,"display","")}else d.create("div",{innerHTML:"\x3cspan\x3e"+c+"\x3c/span\x3e",id:this.id+"_hoverLabel","class":"esriLegendHoverLabel",style:{top:b+"px",left:a+15+"px"}},document.body)},b.clientX,b.clientY,a),500)},e)),b.mouseOutHandler=b.mouseOutHandler||{},b.mouseOutHandler[c.id]=k.connect(a,"onmouseout",l.hitch(this,function(a){this.mouseY=this.mouseX=-1;this.hoverLabelShowing&&(this.hoverLabelShowing=
!1,p.set(t.byId(this.id+"_hoverLabel"),"display","none"))}))},_removeHoverHandlers:function(){var a;c.forEach(this.layers,function(b){if(b.mouseMoveHandler)for(a in b.mouseMoveHandler)k.disconnect(b.mouseMoveHandler[a]);if(b.mouseOutHandler)for(a in b.mouseOutHandler)k.disconnect(b.mouseOutHandler[a])})},_createDynamicLayers:function(a){var b=[],d;c.forEach(a.dynamicLayerInfos||a.layerInfos,function(c){d={id:c.id};d.source=c.source&&c.source.toJson();var e;a.layerDefinitions&&a.layerDefinitions[c.id]&&
(e=a.layerDefinitions[c.id]);e&&(d.definitionExpression=e);var g;a.layerDrawingOptions&&a.layerDrawingOptions[c.id]&&(g=a.layerDrawingOptions[c.id]);g&&(d.drawingInfo=g.toJson());d.minScale=c.minScale||0;d.maxScale=c.maxScale||0;b.push(d)});return b},_getTemplateFromTypes:function(a,b){var c;for(c=0;c<a.length;c++)if(a[c].id==b&&a[c].templates&&0<a[c].templates.length)return a[c].templates[0];return null},_findParentGroup:function(a,b,c){var d,e=b.dynamicLayerInfos||b.layerInfos;for(d=0;d<e.length;d++)if(c==
e[d].id){-1<e[d].parentLayerId&&(p.set(t.byId(this.id+"_"+a+"_"+e[d].parentLayerId+"_group"),"display","block"),this._findParentGroup(a,b,e[d].parentLayerId));break}},_addSubLayersToHide:function(a){function b(d,e){var g=a.layer.dynamicLayerInfos||a.layer.layerInfos,h,k;for(h=0;h<g.length;h++)if(g[h].id===d&&g[h].subLayerIds)for(k=0;k<g[h].subLayerIds.length;k++){var l=g[h].subLayerIds[k];-1===c.indexOf(e,l)&&(e.push(l),b(l,e))}}a.layer.layerInfos&&c.forEach(this.hideLayersInLegend[a.layer.id],function(c){b(c,
this.hideLayersInLegend[a.layer.id])},this)},_isLayerInScale:function(a,b,c){var d,e=!0;if(a.legendResponse&&a.legendResponse.layers)for(d=0;d<a.legendResponse.layers.length;d++){var g=a.legendResponse.layers[d];if(b.id==g.layerId){var h,k;!a.minScale&&0!==a.minScale||!a.maxScale&&0!==a.maxScale?(0==g.minScale&&a.tileInfo&&(h=a.tileInfo.lods[0].scale),0==g.maxScale&&a.tileInfo&&(k=a.tileInfo.lods[a.tileInfo.lods.length-1].scale)):(h=Math.min(a.minScale,g.minScale)||a.minScale||g.minScale,k=Math.max(a.maxScale,
g.maxScale));if(0<h&&h<c||k>c)e=!1;break}}else if(a.minScale||a.maxScale)if(a.minScale&&a.minScale<c||a.maxScale&&a.maxScale>c)e=!1;return e},_getServiceTitle:function(a){var b=a._titleForLegend;b||((b=a.url)?-1<a.url.indexOf("/MapServer")?(b=a.url.substring(0,a.url.indexOf("/MapServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):-1<a.url.indexOf("/ImageServer")?(b=a.url.substring(0,a.url.indexOf("/ImageServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):-1<a.url.indexOf("/FeatureServer")&&
(b=a.url.substring(0,a.url.indexOf("/FeatureServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):b="",a.name&&(b=0<b.length?b+(" - "+a.name):a.name));"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass&&a.vectorFieldPixelFilter&&(a=a.vectorFieldPixelFilter.outputUnit?this["NLS_"+a.vectorFieldPixelFilter.outputUnit]:this["NLS_"+a.vectorFieldPixelFilter.inputUnit],D.isDefined(a)&&(b+=" ("+a+")"));return v.encode(b)},_getEffectiveScale:function(a,b){var c=b.minScale,d=b.maxScale;if(D.isDefined(b.parentLayerId)){var e=
a.layerInfos,g=b.parentLayerId,h;for(h=e.length-1;0<=h;h--)if(e[h].id==g)if(0==c&&0<e[h].minScale?c=e[h].minScale:0<c&&0==e[h].minScale||0<c&&0<e[h].minScale&&(c=Math.min(c,e[h].minScale)),d=Math.max(d||0,e[h].maxScale||0),-1<e[h].parentLayerId)g=e[h].parentLayerId;else break}return{minScale:c,maxScale:d}},_isSupportedLayerType:function(a){return a&&("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&10.2<=a.version||"esri.layers.ArcGISImageServiceVectorLayer"===
a.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===a.declaredClass||"esri.layers.FeatureLayer"===a.declaredClass||"esri.layers.StreamLayer"===a.declaredClass||"esri.layers.KMLLayer"===a.declaredClass||"esri.layers.GeoRSSLayer"===a.declaredClass||"esri.layers.WMSLayer"===a.declaredClass||"esri.layers.CSVLayer"===a.declaredClass)?!0:!1}});l.mixin(O,{ALIGN_LEFT:0,ALIGN_RIGHT:1});b("extend-esri")&&l.setObject("dijit.Legend",O,s);return O});